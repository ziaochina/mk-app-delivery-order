webpackJsonp([0],{1496:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,u=n(2),i=r(u),s=n(52),c=r(s),d=n(5),f=r(d),l=n(10),m=r(l),p=n(7),h=r(p),v=n(8),x=r(v),y=n(0),w=(r(y),n(13)),g=(r(w),n(249)),k=n(564),b=r(k),A=(a=(0,g.wrapper)(b.default))(o=function(e){function t(){return(0,f.default)(this,t),(0,h.default)(this,(t.__proto__||(0,c.default)(t)).apply(this,arguments))}return(0,x.default)(t,e),(0,m.default)(t,[{key:"render",value:function(){return this.props.monkeyKing((0,i.default)({},this.props,{path:"root"}))}}]),t}(y.Component))||o;t.default=A,e.exports=t.default},1497:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=new g.action(e),n=S.default.actionCreator((0,u.default)({},e,{metaAction:t})),r=new O((0,u.default)({},e,{metaAction:t,extendAction:n})),a=(0,u.default)({},t,n.gridAction,r);return t.config({metaHandlers:a}),a}Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),u=r(o),i=n(6),s=r(i),c=n(562),d=r(c),f=n(563),l=r(f),m=n(5),p=r(m),h=n(10),v=r(h);t.default=a;var x=n(0),y=r(x),w=n(13),g=(r(w),n(249)),k=n(561),b=r(k),A=n(69),C=n(9),R=(r(C),n(70)),F=r(R),_=n(1499),S=r(_),O=function(){function e(t){var n=this;(0,p.default)(this,e),this.onInit=function(e){var t=e.component,r=e.injections;n.extendAction.gridAction.onInit({component:t,injections:r}),n.component=t,n.injections=r,r.reduce("init"),n.load()},this.load=(0,l.default)(d.default.mark(function e(){var t,r;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={},e.next=3,n.webapi.deliveryOrder.init({id:n.component.props.voucherId});case 3:r=e.sent,n.injections.reduce("load",r);case 5:case"end":return e.stop()}},e,n)})),this.prev=(0,l.default)(d.default.mark(function e(){var t,r;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.metaAction.gf("data.form.id"),e.next=3,n.webapi.deliveryOrder.prev(t);case 3:r=e.sent,r&&n.injections.reduce("setForm",r);case 5:case"end":return e.stop()}},e,n)})),this.next=(0,l.default)(d.default.mark(function e(){var t,r;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.metaAction.gf("data.form.id"),e.next=3,n.webapi.deliveryOrder.next(t);case 3:r=e.sent,r&&n.injections.reduce("setForm",r);case 5:case"end":return e.stop()}},e,n)})),this.add=function(){n.injections.reduce("setForm")},this.del=(0,l.default)(d.default.mark(function e(){var t,r,a;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.metaAction.gf("data.form.id"),e.next=3,n.metaAction.modal("confirm",{title:"删除",content:"确认删除?"});case 3:if(!(r=e.sent)){e.next=10;break}return e.next=7,n.webapi.deliveryOrder.del({id:t});case 7:a=e.sent,n.metaAction.toast("success","删除单据成功"),n.injections.reduce("setForm",a);case 10:case"end":return e.stop()}},e,n)})),this.audit=(0,l.default)(d.default.mark(function e(){var t,r;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.metaAction.gf("data.form.id")){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,n.webapi.deliveryOrder.audit({id:t});case 5:r=e.sent,r&&n.injections.reduce("setForm",r);case 7:case"end":return e.stop()}},e,n)})),this.moreMenuClick=function(e){switch(e.key){case"del":n.del();break;case"receipt":throw"请实现收款功能";case"history":throw"请实现历史功能"}},this.setting=function(){throw"请实现设置功能"},this.save=(0,l.default)(d.default.mark(function e(){var t,r,a,o;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.metaAction.gf("data.form").toJS(),r=n.checkSave(t),!(r.length>0)){e.next=5;break}return n.metaAction.toast("error",y.default.createElement("ul",{style:{textAlign:"left"}},r.map(function(e){return y.default.createElement("li",null,e)}))),e.abrupt("return");case 5:if(!t.id&&0!=t.id){e.next=12;break}return e.next=8,n.webapi.deliveryOrder.update(t);case 8:a=e.sent,a&&(n.metaAction.toast("success","保存单据成功"),n.injections.reduce("setForm",a)),e.next=16;break;case 12:return e.next=14,n.webapi.deliveryOrder.create(t);case 14:o=e.sent,o&&(n.metaAction.toast("success","保存单据成功"),n.injections.reduce("setForm",o));case 16:case"end":return e.stop()}},e,n)})),this.customerFocus=(0,l.default)(d.default.mark(function e(){var t;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.webapi.customer.query();case 2:t=e.sent,n.metaAction.sf("data.other.customers",(0,A.fromJS)(t));case 4:case"end":return e.stop()}},e,n)})),this.warehouseFocus=(0,l.default)(d.default.mark(function e(){var t;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.webapi.warehouse.query();case 2:t=e.sent,n.metaAction.sf("data.other.warehouses",(0,A.fromJS)(t));case 4:case"end":return e.stop()}},e,n)})),this.ticketTypeFocus=(0,l.default)(d.default.mark(function e(){var t;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.webapi.ticketType.query();case 2:t=e.sent,n.metaAction.sf("data.other.ticketTypes",(0,A.fromJS)(t));case 4:case"end":return e.stop()}},e,n)})),this.stockFocus=(0,l.default)(d.default.mark(function e(){var t;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.webapi.stock.query();case 2:t=e.sent,n.metaAction.sf("data.other.stocks",(0,A.fromJS)(t));case 4:case"end":return e.stop()}},e,n)})),this.taxRateFocus=(0,l.default)(d.default.mark(function e(){var t;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.webapi.taxRate.query();case 2:t=e.sent,n.metaAction.sf("data.other.taxRates",(0,A.fromJS)(t));case 4:case"end":return e.stop()}},e,n)})),this.settlementModeFocus=(0,l.default)(d.default.mark(function e(){var t;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.webapi.settlementMode.query();case 2:t=e.sent,n.metaAction.sf("data.other.settlementModes",(0,A.fromJS)(t));case 4:case"end":return e.stop()}},e,n)})),this.accountFocus=(0,l.default)(d.default.mark(function e(){var t;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.webapi.assetAccount.query();case 2:t=e.sent,n.metaAction.sf("data.other.assetAccounts",(0,A.fromJS)(t));case 4:case"end":return e.stop()}},e,n)})),this.numberFormat=function(e,t){return!0===(arguments.length>2&&void 0!==arguments[2]&&arguments[2])?e:F.default.number.format(e,t)},this.numberChange=function(e,t){return function(r){var a,o=F.default.number.round(r,2),u=F.default.number.round(t.price,2),i=F.default.number.round(u*o,2),c=F.default.number.round(i*(t.tax?t.tax.id:0)/100,2),d=F.default.number.round(i+c,2);n.metaAction.sfs((a={},(0,s.default)(a,"data.form.details."+e+".number",o),(0,s.default)(a,"data.form.details."+e+".amount",i),(0,s.default)(a,"data.form.details."+e+".tax",c),(0,s.default)(a,"data.form.details."+e+".priceTaxTotal",d),a))}},this.priceChange=function(e,t){return function(r){var a,o=F.default.number.round(r,2),u=F.default.number.round(t.number,2),i=F.default.number.round(o*u,2),c=F.default.number.round(i*(t.tax?t.tax.id:0)/100,2),d=F.default.number.round(i+c,2);n.metaAction.sfs((a={},(0,s.default)(a,"data.form.details."+e+".price",o),(0,s.default)(a,"data.form.details."+e+".amount",i),(0,s.default)(a,"data.form.details."+e+".tax",c),(0,s.default)(a,"data.form.details."+e+".priceTaxTotal",d),a))}},this.taxRateChange=function(e,t,r){return function(a){var o,u=r.find(function(e){return e.id==a});if(u){var i=t.amount,c=F.default.number.round(i*u.id/100,2),d=F.default.number.round(i+c,2);n.metaAction.sfs((o={},(0,s.default)(o,"data.form.details."+e+".taxRate",(0,A.fromJS)(u)),(0,s.default)(o,"data.form.details."+e+".tax",(0,A.fromJS)(c)),(0,s.default)(o,"data.form.details."+e+".priceTaxTotal",d),o))}}},this.sumAmount=function(e){return n.numberFormat(n.sum(e,function(e,t){return e+t.amount}),2)},this.sumTax=function(e){return n.numberFormat(n.sum(e,function(e,t){return e+t.tax}),2)},this.sumPriceTaxTotal=function(e){return n.numberFormat(n.sum(e,function(e,t){return e+t.priceTaxTotal}),2)},this.calcBalance=function(e){var t=n.sum(e.form.details,function(e,t){return e+t.priceTaxTotal}),r=n.sum(e.form.settlements,function(e,t){return e+t.settlementAmount}),a=e.form.useAdvance?F.default.number.round(e.form.advanceAmount,2):0;return n.numberFormat(t-r-a,2)},this.metaAction=t.metaAction,this.extendAction=t.extendAction,this.config=b.default.current,this.webapi=this.config.webapi}return(0,v.default)(e,[{key:"checkSave",value:function(e){var t=[];return e.customer&&e.customer.id||t.push("客户不能为空!"),e.date||t.push("单据日期不能为空!"),e.warehouse&&e.warehouse.id||t.push("仓库不能为空!"),e.ticketType&&e.ticketType.id||t.push("仓库不能为空!"),e.details&&0!=e.details.length||t.push("明细不能为空！"),e.details.forEach(function(e,n){e.stock||t.push("明细第"+(n+1)+"行，存货不能为空！")}),t}},{key:"sum",value:function(e,t){return e&&0!=e.length?e.reduce(function(e,n){var r=t(e,n);return isNaN(r)?e:r},0):this.numberFormat(0,2)}}]),e}();e.exports=t.default},1498:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=new d.reducer(e),n=v.default.reducerCreator((0,u.default)({},e,{metaReducer:t})),r=new x((0,u.default)({},e,{metaReducer:t,extendReducer:n}));return(0,u.default)({},t,n.gridReducer,r)}Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),u=r(o),i=n(5),s=r(i);t.default=a;var c=n(69),d=n(249),f=n(561),l=r(f),m=n(565),p=n(9),h=(r(p),n(1499)),v=r(h),x=function e(t){var n=this;(0,s.default)(this,e),this.init=function(e,t){return n.metaReducer.init(e,(0,m.getInitState)())},this.load=function(e,t){var r=t.voucher,a=t.stocks,o=t.customers,u=t.ticketTypes,i=t.warehouses;return e=r?n.metaReducer.sf(e,"data.form",(0,c.fromJS)(r)):n.metaReducer.sf(e,"data",(0,c.fromJS)((0,m.getInitState)().data)),e=n.metaReducer.sf(e,"data.other.stocks",(0,c.fromJS)(a)),e=n.metaReducer.sf(e,"data.other.customers",(0,c.fromJS)(o)),e=n.metaReducer.sf(e,"data.other.ticketTypes",(0,c.fromJS)(u)),e=n.metaReducer.sf(e,"data.other.warehouses",(0,c.fromJS)(i))},this.setForm=function(e,t){return t?n.metaReducer.sf(e,"data.form",(0,c.fromJS)(t)):n.metaReducer.sf(e,"data.form",(0,c.fromJS)((0,m.getInitState)().data.form))},this.metaReducer=t.metaReducer,this.config=l.default.current};e.exports=t.default},1499:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(){return{details:{path:"data.form.details",selectFieldName:"selected",cellClassName:"mk-app-delivery-order-cell",emptyRow:{},getColNames:function(e){return["stockCode","stockName","spec","unit","isGift","number","price","amount","taxRate","tax","priceTaxTotal"]},cellIsReadonly:function(e,t,n){return 1==e.x||2==e.x||3==e.x||7==e.x||9==e.x||10==e.x}}}}function o(e){return{gridAction:new d.default.action((0,s.default)({},e,{gridOption:a()}))}}function u(e){return{gridReducer:new d.default.reducer((0,s.default)({},e,{gridOption:a()}))}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),s=r(i),c=n(1500),d=r(c);t.default={actionCreator:o,reducerCreator:u},e.exports=t.default},1500:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(1501),o=r(a),u=n(1502),i=r(u);t.default={action:o.default,reducer:i.default},e.exports=t.default},1501:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(6),o=r(a),u=n(71),i=r(u),s=n(2),c=r(s),d=n(44),f=r(d),l=n(5),m=r(l),p=n(10),h=r(p),v=n(70),x=r(v),y=function(){function e(t){var n=this;(0,m.default)(this,e),this.onInit=function(e){var t=e.component,r=e.injections;n.component=t,n.injections=r},this.isSelectAll=function(e){if(n.option){"string"==typeof e&&e||(e=(0,f.default)(n.option)[0]);var t=n.metaAction.gf(n.option[e].path);return!(!t||0==t.size)&&t.every(function(t){return t.get(n.option[e].selectFieldName)})}},this.selectAll=function(e){return function(t){n.option&&("string"==typeof e&&e||(e=(0,f.default)(n.option)[0]),n.injections.reduce("selectAll",t.target.checked,e))}},this.getSelectedCount=function(e){if(n.option){"string"==typeof e&&e||(e=(0,f.default)(n.option)[0]);var t=n.metaAction.gf(n.option[e].path);if(!t||0==t.size)return 0;return t.filter(function(t){return!!t.get(n.option[e].selectFieldName)}).size}},this.mousedown=function(e){if(n.option){var t=x.default.path.findPathByEvent(e);if(!n.metaAction.isFocus(t))if(-1!=t.indexOf("cell.cell"))n.focusCell(n.getCellInfo(t),t);else{if(!n.metaAction.focusByEvent(e))return;setTimeout(n.cellAutoFocus,16)}}},this.gridKeydown=function(e){if(n.option){var t="";if(37!=e.keyCode&&39!=e.keyCode&&13!=e.keyCode&&108!=e.keyCode&&9!=e.keyCode&&38!=e.keyCode&&40!=e.keyCode||(t=x.default.path.findPathByEvent(e))&&-1!=t.indexOf(",")){if(37==e.keyCode){if(!x.default.dom.cursorAtBegin(e))return;return void n.moveEditCell(t,"left")}if(39==e.keyCode||13==e.keyCode||108==e.keyCode||9==e.keyCode){if(!x.default.dom.cursorAtEnd(e))return;return void n.moveEditCell(t,"right")}return 38==e.keyCode?void n.moveEditCell(t,"up"):40==e.keyCode?void n.moveEditCell(t,"down"):void 0}}},this.cellAutoFocus=function(){x.default.dom.gridCellAutoFocus(n.component,".editable-cell")},this.getCellClassName=function(e,t,r){if(n.option){"string"==typeof r&&r||(r=(0,f.default)(n.option)[0]);var a=n.option[r].cellClassName,o=n.metaAction.isFocus(e)?a+" editable-cell":"";return t&&(o+=" "+a+"-"+t),o}},this.addRow=function(e){return function(t){n.injections.reduce("addRow",e,t.rowIndex+1)}},this.delRow=function(e){return function(t){n.injections.reduce("delRow",e,t.rowIndex)}},this.metaAction=t.metaAction,t.gridOption&&(this.option=t.gridOption)}return(0,h.default)(e,[{key:"getColNames",value:function(e){return this.option[e].getColNames(this.metaAction.gf)}},{key:"moveEditCell",value:function(e,t){var n=this.getCellInfo(e);this.moveCell(n,t,e)}},{key:"moveCell",value:function(e,t,n){var r=function(e,t,n){return!1},a=(0,f.default)(this.option),o=!0,u=!1,s=void 0;try{for(var d,l=(0,i.default)(a);!(o=(d=l.next()).done);o=!0){var m=d.value;-1!=n.indexOf(m)&&this.option[m].cellIsReadonly&&(r=this.option[m].cellIsReadonly)}}catch(e){u=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(u)throw s}}var p=x.default.matrix.move(e.rowCount,e.colCount,{x:e.x,y:e.y},t);p.x===e.x&&p.y===e.y||(r(p,n,this.metaAction.gf)?this.moveCell((0,c.default)({},e,p),t,n):this.focusCell((0,c.default)({},e,p),n))}},{key:"focusCell",value:function(e,t){var n=(0,f.default)(this.option),r=!0,a=!1,u=void 0;try{for(var s,c=(0,i.default)(n);!(r=(s=c.next()).done);r=!0){var d=s.value;if(-1!=t.indexOf(d)){var l,m=this.getColPathPrefix(t,d);this.metaAction.sfs((l={"data.other.focusFieldPath":""+m+this.getColNames(d)[e.x]+".cell.cell,"+e.y},(0,o.default)(l,"data.other."+d+"ScrollToRow",e.y),(0,o.default)(l,"data.other."+d+"ScrollToColumn",e.x+1),l))}}}catch(e){a=!0,u=e}finally{try{!r&&c.return&&c.return()}finally{if(a)throw u}}setTimeout(this.cellAutoFocus,16)}},{key:"getColPathPrefix",value:function(e,t){return e.substring(0,e.indexOf(t))+t+".columns."}},{key:"getCellInfo",value:function(e){if(this.option){var t=x.default.path.parsePath(e),n=(0,f.default)(this.option),r=!0,a=!1,o=void 0;try{for(var u,s=(0,i.default)(n);!(r=(u=s.next()).done);r=!0){var c=u.value;if(-1!=e.indexOf(c)){var d=this.getColPathPrefix(e,c),l=this.metaAction.gf(this.option[c].path).size,m=this.getColNames(c).length,p=t.path.replace(d,"").replace(".cell.cell","").replace(/\s/g,"");return{x:this.getColNames(c).findIndex(function(e){return e==p}),y:Number(t.vars[0]),colCount:m,rowCount:l}}}}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}}}}]),e}();t.default=y,e.exports=t.default},1502:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),a=function(e){return e&&e.__esModule?e:{default:e}}(r),o=n(69),u=function e(t){var n=this;(0,a.default)(this,e),this.selectAll=function(e,t,r){if(!n.option)return e;var a=n.option[r].path,o=n.option[r].selectFieldName,u=n.metaReducer.gf(e,a);if(!u||0==u.size)return e;for(var i=0;i<u.size;i++)e=n.metaReducer.sf(e,a+"."+i+"."+o,t);return e},this.addRow=function(e,t,r){if(!n.option)return e;var a=n.option[t].path,u=n.option[t].emptyRow||{},i=n.metaReducer.gf(e,a);return i=i.insert(r,(0,o.Map)(u)),n.metaReducer.sf(e,a,i)},this.delRow=function(e,t,r){if(!n.option)return e;var a=n.option[t].path,u=n.metaReducer.gf(e,a);return-1==r?e:(u=u.remove(r),0==u.size&&(u=u.insert(r,(0,o.Map)({}))),n.metaReducer.sf(e,a,u))},this.metaReducer=t.metaReducer,t.gridOption&&(this.option=t.gridOption)};t.default=u,e.exports=t.default}});